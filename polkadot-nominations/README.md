# polkadot-nominations

Fetches and analyzes nominations for a specific validator on the Polkadot network (Asset Hub) via RPC.

For each nominator that targets the configured validator, the tool collects:
- Active stake (DOT)
- All nominated targets with their commission rates
- Commission percentile statistics per nomination and across all results

## Prerequisites

- Node.js >= 20

## Setup

```bash
npm install
```

This will install dependencies and run `npx papi` to generate chain type descriptors from the RPC endpoint.

## Configuration

Edit `config.json`:

```json
{
  "validator": "15Zx4M1W1caBHvwdQY6EjUDVoAv714eEBLcLCuE5A25RqiMH",
  "percentiles": [0.5, 0.75, 0.9],
  "minStakeDot": 0
}
```

| Field | Description |
|---|---|
| `validator` | SS58 address of the validator to filter nominations for |
| `percentiles` | Percentile thresholds for commission analysis (0-1 range) |
| `minStakeDot` | Minimum nominator active stake in DOT. Set to `0` to disable the filter |

The RPC endpoint is configured in `.papi/polkadot-api.json` (generated by `npx papi add`). To override it at runtime:

```bash
RPC_URL=wss://other-node.example.com npm start
```

## Usage

```bash
npm start
```

Output is JSON to stdout, logs go to stderr. To save results:

```bash
npm start > nominations.json
```

## Output format

```json
{
  "validator": "15Zx4M1...",
  "total_nominators": 212,
  "percentiles": { "p50": 3, "p75": 5, "p90": 5 },
  "nominations": [
    {
      "nominator": "19kmu...",
      "stake": 1500,
      "targets": [
        { "address": "15uCA...", "commission": 0 },
        { "address": "15Zx4...", "commission": 4 }
      ],
      "percentiles": { "p50": 1, "p75": 4, "p90": 5 },
      "submitted_in": 1738,
      "suppressed": false
    }
  ]
}
```

## Changing the RPC endpoint

To point to a different node:

```bash
npx papi add ah -w wss://your-rpc-node.example.com
npx papi
```

This updates `.papi/polkadot-api.json` and regenerates the type descriptors.
